<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dr.&nbsp;Francisco Zambrano">

<title>Taller 3: Tabla de Atributos</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="Taller3-Tabla_de_atributos_files/libs/clipboard/clipboard.min.js"></script>
<script src="Taller3-Tabla_de_atributos_files/libs/quarto-html/quarto.js"></script>
<script src="Taller3-Tabla_de_atributos_files/libs/quarto-html/popper.min.js"></script>
<script src="Taller3-Tabla_de_atributos_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Taller3-Tabla_de_atributos_files/libs/quarto-html/anchor.min.js"></script>
<link href="Taller3-Tabla_de_atributos_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Taller3-Tabla_de_atributos_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Taller3-Tabla_de_atributos_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Taller3-Tabla_de_atributos_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Taller3-Tabla_de_atributos_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Tabla de contenidos</h2>
   
  <ul>
  <li><a href="#introducción" id="toc-introducción" class="nav-link active" data-scroll-target="#introducción"><span class="header-section-number">1</span> Introducción</a></li>
  <li><a href="#datos" id="toc-datos" class="nav-link" data-scroll-target="#datos"><span class="header-section-number">2</span> Datos</a></li>
  <li><a href="#actividad-1-modificar-datos-vectoriales" id="toc-actividad-1-modificar-datos-vectoriales" class="nav-link" data-scroll-target="#actividad-1-modificar-datos-vectoriales"><span class="header-section-number">3</span> Actividad 1: Modificar datos vectoriales</a></li>
  <li><a href="#actividad-2-modificar-tabla-de-atributos" id="toc-actividad-2-modificar-tabla-de-atributos" class="nav-link" data-scroll-target="#actividad-2-modificar-tabla-de-atributos"><span class="header-section-number">4</span> Actividad 2: Modificar tabla de atributos</a></li>
  <li><a href="#actividad-3-trabajar-con-la-calculadora-de-campos" id="toc-actividad-3-trabajar-con-la-calculadora-de-campos" class="nav-link" data-scroll-target="#actividad-3-trabajar-con-la-calculadora-de-campos"><span class="header-section-number">5</span> Actividad 3: Trabajar con la calculadora de campos</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Taller 3: Tabla de Atributos</h1>
<p class="subtitle lead">Introducción a la Tecnología de Información Geográfica (IMSE1014)</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Autor/a</div>
    <div class="quarto-title-meta-contents">
             <p>Dr.&nbsp;Francisco Zambrano </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Fecha de publicación</div>
    <div class="quarto-title-meta-contents">
      <p class="date">25 de marzo de 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="introducción" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introducción</h1>
<p><strong>Objetivos:</strong> - Trabajar con la tabla de atributos de datos vectoriales para crear y eliminar atributos. - Usar la tabla de atributos para modificar la simbología del mapa</p>
<p>Este laboratorio incluye las siguientes tareas:</p>
<ul>
<li><code>Actividad 1:</code> Modificar datos vectoriales</li>
<li><code>Actividad 2:</code> Modificar la tabla de atributos.</li>
<li><code>Actividad 3:</code> Trabajar con la calculadora de campos</li>
</ul>
</section>
<section id="datos" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Datos</h1>
<p>Para el taller utilizará modelos de datos geoespaciales de tipo vectorial y raster.</p>
<ul>
<li><code>datos vectoriales</code>: desde la IDE del Ministerio de Medio Ambiente (https://www.ide.cl/index.php/medio-ambiente) debe descargar las siguientes capas:
<ul>
<li><code>cuencas BNA</code>: delimitación de las cuencas hidrográficas de Chile. <a href="https://drive.google.com/file/d/1z8rhLNND6MiYZv8RkJ4YYNh3ZG6xxfu9/view?usp=sharing">Descargar acá</a></li>
<li><code>estaciones de calidad de aire</code>: estaciones de monitoreo del Sistema de Información Nacional de Calidad de aire (SINCA) . <a href="https://drive.google.com/file/d/13V_CXbPpmJ4UFuuCanOqQhRp8qF38HWc/view?usp=sharing">Descargar acá</a></li>
<li><code>sendero de Chile</code>: Conjunto de rutas que atraviesan el país, contribuyendo a la protección de la naturaleza, a través de la generación de un espacio de acceso público. Esta información se encuentra para todo el país. <a href="https://drive.google.com/file/d/1PDV3zeYpf7q7ptT7866-4vcADAOuzdMR/view?usp=sharing">Descargar acá</a></li>
</ul></li>
<li><code>datos raster:</code>
<ul>
<li><code>dem_chile</code>: capa de elevaciones para todo Chile. <a href="https://drive.google.com/file/d/1r9qT1QC9Unyfo1AQ5oFKHj6_5RJY_it1/view?usp=sharing">Descargar acá</a></li>
</ul></li>
</ul>
</section>
<section id="actividad-1-modificar-datos-vectoriales" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Actividad 1: Modificar datos vectoriales</h1>
<p>El objetivo de esta actividad es seleccionar y trabajar sólo con las geometrias que se encuentran en la cuenca del río Rapel.</p>
<ol type="1">
<li>Debe cargar las capas vectoriales de cuencas, estaciones de calidad de aire y sendero de Chile.</li>
</ol>
<p><img src="img/img1.png" class="img-fluid"></p>
<ol start="2" type="1">
<li>Debe buscar en la tabla de atributos de la capa “cuencas_bna_centro” la entidad u objeto espacial que corresponde a “Río Rapel” y seleccionarla.</li>
</ol>
<p><img src="img/img2.png" class="img-fluid"></p>
<ol start="3" type="1">
<li>Una vez seleccionada, debe guardar la entidad espacial seleccionada. La vamos a guardar con formato GeoPackage (.gpkg). Debe hacer clic con el boton derecho en la capa y luego seleccionar “Exportar” -Z “Exportar objetos seleccionados como…”</li>
</ol>
<p><img src="img/img3.png" class="img-fluid"></p>
<ol start="4" type="1">
<li>Para crear el GeoPackage, debe cambiar el formato a “GeoPackage”, luego debe inciar el nombre de la capa, en este caso, le pondremos “cuenca rio rapel”. Hay que indicar en que carpeta y con que nombre se guardará el archivo. En este caso lo guardareos como “rapel.gpkg”</li>
</ol>
<p><img src="img/img4.png" class="img-fluid"> 5. Ahora eliminamos la capa original de “cuencas_bna_centro”</p>
<p><img src="img/img5.png" class="img-fluid"></p>
<ol start="6" type="1">
<li>Debe quedar algo como se muestra en la siguiente imagen</li>
</ol>
<p><img src="img/img6.png" class="img-fluid"></p>
<ol start="7" type="1">
<li><p>Ahora debemos quedarnos con todas las geometrias que se encuentran dentro de la cuenca del río Rapel.</p></li>
<li><p>Vamos a seleccionar los objetos espaciales de la capa “sendero de Chile”, que se encuentran dentro de la cuenca del río Rapel. Por lo que vamos a hacer un proceso de “Selección por localización”</p></li>
<li><p>Debe ir al menu “Vectorial”-&gt;“Herramienta de Investigación”-&gt;“Selección por lozalización”</p></li>
</ol>
<p><img src="img/img7.png" class="img-fluid"> 10. En el menu que se depliega, debe (1) seleccionar la capa desde la que se quieren seleccionar los objetos espaciales y (2) con respecto a que capa espacial. Por defecto QGIS realizará un proceso espacial de seleccón por intersección. Luego dar clic a (3) Aceptar.</p>
<p><img src="img/img8.png" class="img-fluid"></p>
<ol start="11" type="1">
<li>Ahora, deben estar seleccionados los objetos espaciales de la capa “sendero de chile” que se encuentran en la cuenca del río Rapel.</li>
</ol>
<p><img src="img/img9.png" class="img-fluid"> 12. Ahora, de la misma forma como se guardó la cuenca del río Rapel, realizamos el proceso de guardar los objetos seleccionados.</p>
<p><img src="img/img10.png" class="img-fluid"></p>
<ol start="13" type="1">
<li>Lo vamos a guardar en el mismo archivo GeoPackage “rio_rapel.gpkg”, pero con el nombre de capa “sendero de chile”</li>
</ol>
<p><img src="img/img11.png" class="img-fluid"></p>
<ol start="14" type="1">
<li>Eliminamos la capa “senderos de chile” original.</li>
</ol>
<p><img src="img/img12.png" class="img-fluid"></p>
<ol start="15" type="1">
<li>Por lo que ahora tenemos sólo los tramos de senderos que se intersectan con el polígono de la cuenca del río Rapel.</li>
</ol>
<p><img src="img/img13.png" class="img-fluid"></p>
<ol start="16" type="1">
<li>Por último, repetimos el proceso con los puntos de estaciones de calidad de aire.</li>
</ol>
<p><img src="img/img14.png" class="img-fluid"> 17. Una vez seleccionadas las estaciones que se encuentran en la cuenca del río Rapel. La vamos a incorporar como capa adicional al archivo GeoPackage.</p>
<p><img src="img/img15.png" class="img-fluid"></p>
<ol start="18" type="1">
<li>Finalmente, deberiamos quedarnos con tres capas con objetos espaciales que se encuentran en la cuenca del río Rapel.</li>
</ol>
<p><img src="img/img16.png" class="img-fluid"></p>
</section>
<section id="actividad-2-modificar-tabla-de-atributos" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Actividad 2: Modificar tabla de atributos</h1>
<p>Vamos a modificar los atributos de las tres capas vectoriales. Para lo que debemos trabajar con la tabla de atributos.</p>
<ol type="1">
<li>Seleccionamos la capa “cuenca rio rapel”, haga clic con el boton derecho del mouse y seleccione abrir tabla de atributos.</li>
</ol>
<p><img src="img/img17.png" class="img-fluid"></p>
<ol start="2" type="1">
<li>En la tabla de atributos, haga clic en el icono de “conmutar el modo edición”</li>
</ol>
<p><img src="img/img18.png" class="img-fluid"></p>
<ol start="3" type="1">
<li><p>Ahora la capa se encuentra en modo de edición y esp posible hacer modificaciones.</p></li>
<li><p>Vamos a eliminar el atributo “Area_km2”. Para eso haga clic en “elimina campo”, en la ventana que se despliega seleccione el campo “Area_km2”. De clic a “Aceptar”</p></li>
</ol>
<p><img src="img/img19.png" class="img-fluid"> 5. Ahora debe agregar un nuevo campo para el nombre de la región. Debe hacer clic en “Campo nuevo” y luego le vamos a poner como nombre “Región”, como tipo “Texto” y que se pueda almacenar una cadena de texto de 50 carácteres.</p>
<p><img src="img/img20.png" class="img-fluid"></p>
<ol start="6" type="1">
<li>Ahora debe hacer doble clic con el boton izquierdo del mouse en el espacio para el campo “Region” en la geometría. Debe escribir “Libertador Bernardo O’Higgins”. Luegoo haga clic en el icono “guardar” y por último desactive el conmutador de edición.</li>
</ol>
<p><img src="img/img21.png" class="img-fluid"></p>
<ol start="7" type="1">
<li>Ahora modifique la tabla de atributos de la capa “estaciones_calidad”. Abra la tabla de atributos, conmute edición y eliminar campo. Seleccione los campos que se indican en la siguiente figura.</li>
</ol>
<p><img src="img/img22.png" class="img-fluid"></p>
<ol start="8" type="1">
<li><p>El campo de “altura” que corresponde a la elevación no se encuentra con información para ninguno de los objetos. Por lo que vamos a completarlos.</p></li>
<li><p>Primero, debe cargar la capa raster de “dem_ohiggins”. La que corresponde a una capa raster dónde en cada pixel contiene un valor correspondiente a la elevación.</p></li>
</ol>
<p><img src="img/img23.png" class="img-fluid"></p>
<ol start="10" type="1">
<li>Ahora, en la tabla de atributos de calida del agua debe seleccionar cada uno de los objetos y hacer un zoom al objeto seleccionado.</li>
</ol>
<p><img src="img/img24.png" class="img-fluid"></p>
<ol start="11" type="1">
<li>Debe seleccionar la capa “dem_ohiggins” en el panel de capas y luego utilizar el “identificado de objetos” para que al hacer clic en la ubicación de la estación, se despliegue el valor de elevación que tiene.</li>
</ol>
<p><img src="img/img25.png" class="img-fluid"></p>
<ol start="12" type="1">
<li>Luego, en la tabla de atributos de la capa “estaciones calidad” debe ir rellenando con los valores de elevaciones que corresponde a cada estación.</li>
</ol>
<p><img src="img/img26.png" class="img-fluid"> 13. Por último, a la capa de “senderos de Chile”, vamos a eliminar los campos de acuerdo a como se muestra en la siguiente figura.</p>
<p><img src="img/img27.png" class="img-fluid"></p>
<ol start="14" type="1">
<li>Finalmente, guardamos los cambios y desactivamos el conmutador de edición.</li>
</ol>
</section>
<section id="actividad-3-trabajar-con-la-calculadora-de-campos" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Actividad 3: Trabajar con la calculadora de campos</h1>
<p>El botón Calculadora de campo en la tabla de atributos le permite realizar cálculos sobre la base de valores de atributos existentes o funciones definidas, por ejemplo, para calcular la longitud o el área de características geométricas. Los resultados pueden usarse para actualizar un campo existente o escribirse en un campo nuevo (que puede ser virtual).</p>
<p>La calculadora de campo está disponible en cualquier capa que admita edición. Cuando hace clic en el icono de la calculadora de campo, se abre el cuadro de diálogo. Si la capa no está en modo de edición, se muestra una advertencia y el uso de la calculadora de campo hará que la capa se ponga en modo de edición antes de realizar el cálculo.</p>
<p>Basado en el cuadro de diálogo “Generador de expresiones”, el cuadro de diálogo de la calculadora de campos ofrece una interfaz completa para definir una expresión y aplicarla a un campo existente o recién creado. Para utilizar el cuadro de diálogo de la calculadora de campo, debe seleccionar si desea:</p>
<ol type="1">
<li>Abra la tabla de atributos de la capa “sendero de Chile”</li>
</ol>
<p><img src="img/img28.png" class="img-fluid"></p>
<ol start="2" type="1">
<li>Abra la “Calculadora de campos”. Ahora va a crear un nuevo atributo (campo) en dónde QGIS deberá calcular el perometro de cada segmento de linea.</li>
</ol>
<p><img src="img/img29.png" class="img-fluid"></p>
<ol start="3" type="1">
<li>De la funciones que tiene la “Calculadora de campos” debe seleccionar <code>$length</code>, que corresponde a la función que hace el cálculo del perímetro. Debe indicar un nombre para el nuevo campo, en este caso lo llamarémos “Perimetro”, debe elegir el tipo de dato que almacenara, en este caso deje el valor por defecto, entero de 32 bit. Luego debe hacer clic en “Aceptar”.</li>
</ol>
<p><img src="img/img30.png" class="img-fluid"></p>
<ol start="4" type="1">
<li>Ahora al ver la “Tabla de Atributos”, puede apreciar que hay un nuevo campo, llamado “Perimetro”. En cada fila se calculó la longitud del segmento de linea. Debe guardar los cambios y desactivar el “conmutador de edición”.</li>
</ol>
<p><img src="img/img31.png" class="img-fluid"></p>
<ol start="5" type="1">
<li>Ahora, abra la tabla de atributos de la capa “cuencas_bna_centro”. Active el conmutador de edición.</li>
</ol>
<p><img src="img/img32.png" class="img-fluid"></p>
<ol start="6" type="1">
<li>Abra la calculadora de campos. Aplique la función <code>$area</code>, la que corresponde a una función predefinida en QGIS que permite calcular el área de cada objeto espacial (entidad).</li>
</ol>
<p><img src="img/img33.png" class="img-fluid"></p>
<ol start="7" type="1">
<li>Ahora la tabla de atributos debe tener un nuevo campo, llamado “Area”. En cada celda esta el valor calculado de área en metros, para cada entidad espacial.</li>
</ol>
<p><img src="img/img34.png" class="img-fluid"></p>
<ol start="8" type="1">
<li>Ahora abra la “Tabla de Atributos” de la capa “estaciones_calidad”. Para cada entidad espacial (estación) vamos a calcular su coordenada.</li>
</ol>
<p><img src="img/img35.png" class="img-fluid"></p>
<ol start="9" type="1">
<li>Abra la “Calculadora de campos”. Ahora para obtener la coordenada en X y en Y, debe utilizar las funciones <code>$x</code> e <code>$y</code>. En el caso de la capa “estaciones_calidad” sus coordenadas se encuentran en grados decimales, por lo que el valor que vamos a obtener es en decimales. Por lo que el tipo de dato hay que definirlo como “real”.</li>
</ol>
<p><img src="img/img36.png" class="img-fluid"></p>
<p><img src="img/img37.png" class="img-fluid"></p>
<ol start="10" type="1">
<li>Finalmente, la tabla de atributos debe tener dos campos más, que corresponden a las coordenadas de cada unos de los objetos espaciales (estaciones).</li>
</ol>
<p><img src="img/img38.png" class="img-fluid"></p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiado");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiado");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>